angular.module("SysConfig",[]),angular.module("SysConfig").constant("SysConfig",{resourceBase:"http://118.186.210.42:280",html5Url:"http://m.1dume.com.cn",online_openApi:"http://openapi.1du.me",online_resourceBase:"http://image.1dume.com.cn"}),angular.module("env",[]),angular.module("env").service("$env",["$window","$document","$timeout","$location","SysConfig",function(e,t,o,n,i){function a(){return d?"ios":p?"android":"web"}function r(t,o,n){return"toUserHome"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/userList/"+o.id):"toQuestion"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/addSkillTitle"):"toAnswer"==t&&f!==!0?void setTimeout(function(){e.location.href="http://"+c+"/index.html#/addArticle/answer/"+o.id+"?p="+o.p+"&img="+o.img},500):("appDownload"==t&&(t="openInBrowser"),"toToastCallBack"==t?void notie.alert(5,o.toast,1):("toast"==t&&e.localStorage.setItem("toastValue",o),"toUserHome"==t&&e.localStorage.setItem("toUserId",o.id),"iosAppDownload"==t&&e.localStorage.setItem("iosAppDownloadURL",o),"openInBrowser"==t&&e.localStorage.setItem("openInBrowserUrl",o.url),void e.localStorage.setItem("messageForIosClient",t)))}function s(t,o,n){return"toUserHome"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/userList/"+o.id):"toQuestion"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/addSkillTitle"):"toAnswer"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/addArticle/answer/"+o.id+"?p="+o.p+"&img="+o.img):"appDownload"==t&&f!==!0?void(e.location.href=o.url):0==f&&"toToastCallBack"==t?void notie.alert(5,o.toast,1):void(void 0==o?e.WebViewJavascriptBridge[t].call(e.WebViewJavascriptBridge):e.WebViewJavascriptBridge[t].call(e.WebViewJavascriptBridge,angular.toJson(o)))}function l(t,o,n){return"toUserHome"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/userList/"+o.id):"toQuestion"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/addSkillTitle"):"toAnswer"==t&&f!==!0?void(e.location.href="http://"+c+"/index.html#/addArticle/answer/"+o.id+"?p="+o.p+"&img="+o.img):("toToastCallBack"==t?notie.alert(5,o.toast,1):"appDownload"==t&&(e.location.href=o.url),void n())}var c=i.html5Url,u=e.navigator.userAgent,d=/iphone|ipod/i.test(u),p=/android/i.test(u),m=/MicroMessenger/i.test(u),f=/yidumi/i.test(u),h=void 0==n.search()._token&&void 0==n.search().user_id,g=d?r:p?s:l;this.platform=a,this.isIOS=d,this.inWeixin=m,this.isAndroid=p,this.readOnlyInHere=h,this.setInClient=function(e){f=e},this.call=function(e,t,o){angular.isFunction(t)&&(o=t,t=null),o||(o=angular.noop),g(e,t,o)}}]),angular.module("apps",["SysConfig","env"]),angular.module("apps").filter("resource",["SysConfig",function(e){return function(t){return t?0==t.indexOf("http")?t:e.resourceBase+"/"+t:null}}]),angular.module("apps").filter("securityLevel",[function(){var e={0:"安全",1:"较安全",2:"未检测"};return function(t){return e[t]||e[2]}}]),angular.module("apps").filter("mb",["$filter",function(e){return function(t){return t?e("number")(t/1024/1024)+"MB":void 0}}]),angular.module("apps").factory("appDownload",["$window","$env","SysConfig",function(e,t,o){return function(n,i){var a={id:n.id};if(t.isAndroid&&t.inClient){a.packageName=n.packageName,a.apkUrl=n.apkUrl;var r=n.appId?"http://itunes.apple.com/cn/app/id"+n.appId:(0==n.apkUrl.indexOf("http")?n.apkUrl:o.resourceBase+"/"+n.apkUrl)+(n.packageName?"?filename="+n.packageName+".apk":"");return void t.call("appDownload",{url:r})}if(t.isIOS&&t.inClient){a.bundleId=n.bundleId,a.appId=n.appId;var r;"client_open"==i||"client_download"==i?n.url:"http://itunes.apple.com/cn/app/id"+n.appId;return r=n.appId?"http://itunes.apple.com/cn/app/id"+n.appId:(0==n.apkUrl.indexOf("http")?n.apkUrl:o.resourceBase+"/"+n.apkUrl)+(n.packageName?"?filename="+n.packageName+".apk":""),void t.call("iosAppDownload",r)}var r=("client_open"==i||"client_download"==i?n.url:"http://itunes.apple.com/cn/app/id"+n.appId,"");r=n.appId?"http://itunes.apple.com/cn/app/id"+n.appId:(0==n.apkUrl.indexOf("http")?n.apkUrl:o.resourceBase+"/"+n.apkUrl)+(n.packageName?"?filename="+n.packageName+".apk":""),e.location.href=t.canDownload?r:"/html/sys_browser.html?t="+t.platform()+"_"+(i||"app_download")+"&url="+r}}]),angular.module("apps").factory("findDetails",["$window","$location","$env","clientDownload","SysConfig",function(e,t,o,n,i){return function(t,o,n){e.location.href="/"+t+"/detail.html?id="+o+"&base="+n.base+"&res="+i.resourceBase+"&user_id="+n.user_id+"&_token="+n._token+"&inClient="+(n.inClient?n.inClient:"false")+"&isCanBack=true"}}]),angular.module("apps").factory("clientDownload",["$window","$location","$env","appDownload",function(e,t,o,n){return function(i,a){var r="1"==t.search().isappinstalled,s=r?"client_open":"client_download",l="yidumi://";o.isIOS?n(r?{url:l}:{appId:759795923,url:"http://itunes.apple.com/cn/app/xia-yi-ge/id759795923?mt=8"},s):o.isAndroid?n(r?{apkUrl:l}:{apkUrl:"http://app.xiaomi.com/download/53123",packageName:"com.winsland.findapp"},s):e.location.href="/html/client_download.html"}}]),angular.module("YiModule",["env","SysConfig"]),angular.module("YiModule").directive("errSrc",function(){return{link:function(e,t,o){""!=o.ngSrc&&void 0!=o.ngSrc||o.$set("src",o.errSrc),t.bind("error",function(){o.src!=o.errSrc&&o.$set("src",o.errSrc)})}}}),angular.module("YiModule").directive("focus",function(){return function(e,t,o){o.$observe("focus",function(e){"true"===e&&t[0].focus()})}}),angular.module("YiModule").directive("sectionScroll",["$window",function(e){return function(t,o){var n=e.document.querySelector(".header-img-container"),i=1.2*n.offsetHeight;e.addEventListener("scroll",function(){var e=o[0].scrollTop;e>i||(n.style.top=-e/2+"px")})}}]),angular.module("YiModule").directive("bindHtmlUnsafe",function(){return function(e,t,o){t.addClass("ng-binding").data("$binding",o.bindHtmlUnsafe),e.$watch(o.bindHtmlUnsafe,function(e){t.html(e||"")})}}),angular.module("YiModule").filter("shijian",function(){return function(e){if(e){var t=new Date(e),o=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return o}}}),angular.module("YiModule").filter("scoreFilter",function(){return function(e){return 0>e?(e=0-e,0-(e+10)*Math.sqrt(e+10).toFixed(0)):(e+10)*Math.sqrt(e+10).toFixed(0)}}),angular.module("YiModule").filter("findPFilter",function(){function e(e){for(var t=0,o=0;o<e.length;o++){var n=e.charAt(o);t+=encodeURI(n).length>2?1:.5}return t}function t(e,t){for(var o=0,n=0;n<e.length;n++){var i=e.charAt(n);if(o+=encodeURI(i).length>2?1:.5,o>=t){var a=o==t?n+1:n;return e.substr(0,a)}}}return function(o,n){if(void 0==o||0==o.length)return"回答为空";if(o.length>0){for(var i=0;i<o.length;i++)if(void 0!==o[i].p&&""!==o[i].p)return o[i].p=o[i].p.replace(/<\/?.+?>/g,""),e(o[i].p)<n?o[i].p:t(o[i].p,n)+"...";return"有图为证"}}}),angular.module("YiModule").filter("stringFilter",function(){function e(e){for(var t=0,o=0;o<e.length;o++){var n=e.charAt(o);t+=encodeURI(n).length>2?1:.7}return t}function t(e,t){for(var o=0,n=0;n<e.length;n++){var i=e.charAt(n);if(o+=encodeURI(i).length>2?1:.7,o>=t){var a=o==t?n+1:n;return e.substr(0,a)}}}return function(o,n){return e(o)<n?o:t(o,n)+"..."}}),angular.module("YiModule").service("YiServer",["$http","$window","$q","$rootScope","$env","ngDialog","$location","SysConfig",function(e,t,o,n,i,a,r,s){n.param=r.search(),n.param.base||(n.param.base=s.online_openApi),n.param.res||(n.param.res=s.online_resourceBase),n.param.res&&(s.resourceBase=n.param.res),n.clientType=i.isIOS?"ios":"android",n.scrollUpOrDown=!1;var l=0;this.scrollUpOrDown=function(){var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight,o=document.documentElement.scrollHeight||document.body.scrollHeight;e>l?(n.scrollUpOrDown=!0,n.$apply()):l>e&&(n.scrollUpOrDown=!1,n.$apply()),e/(o-t)>=.95&&(n.scrollUpOrDown=!1,n.$apply()),l=e};var c,u;this.toTop=function(e){function t(){c>e&&c-e>30?(c-=30,window.scrollTo(0,c)):e>c&&e-c>30?(c+=30,window.scrollTo(0,c)):(clearInterval(u),window.scrollTo(0,e))}clearInterval(u),c=window.scrollY,u=setInterval(t,1)},this.getDetail=function(t,a){var r=o.defer();return e.jsonp(a.base+"/v3/"+t+"/"+a.id+"?_client="+n.clientType+"&callback=JSON_CALLBACK",{params:a}).success(function(t){e.get(a.base+"/v3/users/"+a.user_id+"?_client="+n.clientType+"&_cver=28828&_token="+a._token).success(function(e){1==e.data.type&&1!=i.inClient,n.loginUserNickName=e.data.nickName,r.resolve(t)})}).error(function(e){r.reject(e)}),r.promise},this.getUserDetail=function(t,i){var a=o.defer();return e.get(t.base+"/v3/users/"+i+"?_client="+n.clientType+"&_cver=28828&_token="+t._token).success(function(e){a.resolve(e)}),a.promise},this.answerZanOrCai=function(t,i){var a=o.defer();return e.get(n.param.base+"/v4/answers/"+t+"/viewpoint?view="+i+"&_client="+n.clientType+"&_cver=28828&_token="+n.param._token).success(function(e){a.resolve(e)}),a.promise},this.isInclude=function(e,t){var o=!1;return angular.forEach(e,function(e,n){n==t&&(o=!0)}),o},this.getComments=function(t,i,a,r){var s=o.defer();return e.get(i.base+"/v3/"+t+"/"+i.id+"/comments?type=1&_token="+i._token+"&_client="+n.clientType+"&offset="+a+"&limit="+r).success(function(e){s.resolve(e)}),s.promise},this.toComment=function(t,i,a,r){var s=o.defer();return e.post(i.base+"/v3/"+t+"/"+i.id+"/commentsForJsonp",{type:1,content:a,replyTo:r},{params:{_client:n.clientType,_cver:"28828",_token:i._token},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){s.resolve(e)}),s.promise},this.shareStatistics=function(t,i,a){var r=o.defer();return e.post(t.base+"/v4/users/me/"+i+"/share",{},{params:{_client:n.clientType,_cver:"28828",_token:t._token,id:t.id,channel:a},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},this.appStatistics=function(t,i,a,r){var s=o.defer();return e.post(t.base+"/v3/apps/androidForJsonp/"+i,{origin:a,cat:r,objId:t.id},{params:{_client:n.clientType,_cver:"28828",_token:t._token},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.smartDeviceStatistics=function(t,i,a,r){var s=o.defer();return e.post(t.base+"/v3/devices/"+i+"/clickForJsonp",{origin:a,cat:r,objId:t.id},{params:{_client:n.clientType,_cver:"28828",_token:t._token},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.focusAuthor=function(t,i){var a=o.defer();return e.post(t.base+"/v3/users/me/subscribes",{},{params:{users:i,_client:n.clientType,_token:t._token},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){a.resolve(e)}),a.promise},this.unFocusAuthor=function(t,i){var a=o.defer();return e.get(t.base+"/v3/users/me/subscribesForJsonp?users="+i+"&_client="+n.clientType+"&_cver=28828&_token="+t._token).success(function(e){a.resolve(e)}),a.promise},this.collecteType=function(t,i){var a=o.defer();return e.post(i.base+"/v3/users/me/"+t+"/collections?",{},{params:{id:i.id,_client:n.clientType,_cver:"28828",_token:i._token},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){a.resolve(e)}),a.promise},this.unCollecteType=function(t,i){var a=o.defer();return e.get(i.base+"/v3/users/me/"+t+"/collectionsForJsonp?id="+i.id+"&_client="+n.clientType+"&_cver=28828&_token="+i._token).success(function(e){a.resolve(e)}),a.promise},this.clickAttitude=function(t,i,a,r){var s=o.defer();return e.jsonp(i.base+"/v3/"+t+"/"+a+"/attitude?att="+r+"&_client="+n.clientType+"&_token="+i._token+"&callback=JSON_CALLBACK").success(function(e){s.resolve(e)}),s.promise},this.clickCommentZan=function(t,i,a){var r=o.defer();return e.post(i.base+"/v3/"+t+"/comments/"+a+"/attitude",{},{params:{att:"1",_client:n.clientType,_cver:"28828",_token:i._token},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},this.toSignFree=function(i){var a=o.defer(),r="";return e.jsonp(i.base+"/v3/users/me/0/sharwe?_client=7&callback=JSON_CALLBACK").success(function(o){r=o.token,e.get(i.base+"/v3/users/"+o.id+"?_client="+n.clientType+"&_cver=28828&_token="+r).success(function(e){e.data.token=r,t.localStorage.setItem("login_user_token",e.data.token),t.localStorage.setItem("login_user_id",e.data.id),n.param._token=e.data.token,n.param.user_id=e.data.id,n.loginUserNickName=e.data.nickName,n.isVisitor=!0,a.resolve(e)})}),a.promise},this.toSign=function(i,a,r,s){var l=o.defer(),c="";return e.jsonp(i.base+"/v3/users/me/1/sharwe?_client="+n.clientType+"&cat=1&name="+a+"&pwd="+r+"&nickName="+s+"&callback=JSON_CALLBACK").success(function(o){void 0!==o.token?(c=o.token,e.get(i.base+"/v3/users/"+o.id+"?_client="+n.clientType+"&_cver=28828&_token="+c).success(function(e){e.data.token=c,t.localStorage.setItem("login_user_token",e.data.token),t.localStorage.setItem("login_user_id",e.data.id),n.param._token=e.data.token,n.param.user_id=e.data.id,n.loginUserNickName=e.data.nickName,n.isVisitor=!1,l.resolve(e)})):l.resolve(o)}),l.promise},this.toLogin=function(i,a,r){var s=o.defer(),l="";return e.jsonp(i.base+"/v3/users/0/loginForCampus?_client="+n.clientType+"&name="+a+"&pwd="+r+"&callback=JSON_CALLBACK").success(function(o){void 0!==o.token?(l=o.token,e.get(i.base+"/v3/users/"+o.id+"?_client="+n.clientType+"&_cver=28828&_token="+l).success(function(e){e.data.token=l,t.localStorage.setItem("login_user_token",e.data.token),t.localStorage.setItem("login_user_id",e.data.id),n.param._token=e.data.token,n.param.user_id=e.data.id,n.loginUserNickName=e.data.nickName,n.isVisitor=!1,s.resolve(e)})):s.resolve(o)}),s.promise},this.focusTag=function(t,i){var a=o.defer();return e.post(t.base+"/v3/users/me/subscribes",{},{params:{tags:i,_client:n.clientType,_token:t._token},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){a.resolve(e)}),a.promise},this.UnFocusTag=function(t,i){var a=o.defer();return e.get(t.base+"/v3/users/me/subscribesForJsonp",{params:{tags:i,_client:n.clientType,_token:t._token}}).success(function(e){a.resolve(e)}),a.promise},this.getInstructions=function(t,i){var a=o.defer();return e.get(t.base+"/v3/questions",{params:{devicesId:t.id,_client:n.clientType,_cver:28828,limit:i,_token:t._token}}).success(function(e){a.resolve(e)}),a.promise},this.getLongTimeAgo=function(e){var t=e.substring(0,4),o=e.substring(4,6),n=e.substring(6,8),i=e.substring(8,10),a=e.substring(10,12),r=e.substring(12,14),s=t+"/"+o+"/"+n+" "+i+":"+a+":"+r;Date.prototype.diff=function(e){return this.getTime()-e.getTime()};var l=new Date,e=new Date(s),c=l.diff(e),u=c/31104e6,d=c/2592e6,p=c/864e5,m=c/36e5,f=c/6e4,h=c/1e3;return Math.floor(u)>0?Math.floor(u)+"年前":Math.floor(d)>0?Math.floor(d)+"个月前":Math.floor(p)>0?Math.floor(p)+"天前":Math.floor(m)>0?Math.floor(m)+"小时前":Math.floor(f)>0?Math.floor(f)+"分钟前":Math.floor(h)>0?Math.floor(h)+"秒前":""},this.appDownloadDialog=function(e){a.open({id:"appDialog",template:"html/appDialog.html",className:"ngdialog-theme-plain",controller:["$scope","appDownload","YiServer",function(e,t,o){e.appDownload=function(e){o.appStatistics(n.param,e.id,1,2).then(function(e){}),t(e)}}],data:{appData:e},showClose:!1})},this.smartDialog=function(e){a.open({id:"fromAService",template:"html/smartDeviceDialog.html",className:"ngdialog-theme-plain",controller:["$scope","$env","YiServer","findDetails",function(e,t,o,i){e.deviceOrder=function(e,i){o.smartDeviceStatistics(n.param,i,1,2).then(function(e){}),t.call("appDownload",{url:0==e.indexOf("http")?e:s.resourceBase+"/"+e})},e.findDetails=function(e,t){o.smartDeviceStatistics(n.param,t,1,1).then(function(e){}),i(e,t,n.param)}}],data:{devicesData:e},showClose:!1})},this.shareDialog=function(e){a.open({id:"ShareDialog",template:"html/shareDialog.html",controller:["$scope","$location","$env","$window",function(t,o,n,i){function a(e){var t,o,n,i;for(t="",n=e.length,o=0;n>o;o++)i=e.charCodeAt(o),i>=1&&127>=i?t+=e.charAt(o):i>2047?(t+=String.fromCharCode(224|i>>12&15),t+=String.fromCharCode(128|i>>6&63),t+=String.fromCharCode(128|i>>0&63)):(t+=String.fromCharCode(192|i>>6&31),t+=String.fromCharCode(128|i>>0&63));return t}t.$env=n;var r="http://"+o.$$host+":"+o.$$port+o.$$path+"?id="+o.$$search.id+"&base="+o.$$search.base+"&res="+o.$$search.res;t.data={},t.data.url=encodeURIComponent(r),t.showCode=!1,a(t.data.url),t.URL_share={},t.URL_share.shareToSina="http://service.weibo.com/share/share.php?url="+t.data.url+"&title="+e+"&pic=",t.URL_share.shareToQQzone="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+t.data.url+"&title="+e+"&desc="+e+"&summary="+e+"&site=",t.qqshare=function(){n.call("shareToQQ")},t.qqZoneShare=function(){n.call("shareToQzone")},t.shareToWeibo=function(){n.call("shareToWeibo")},t.shareWeChat=function(){n.call("shareToWechat")},t.shareWeChatZone=function(){n.call("shareToWechatZone")},t.xinlangShare=function(){n.call("shareSina")}}],className:"ngdialog-theme-plain",showClose:!1})},this.commentDialog=function(e){a.open({id:"commentDialog",template:"html/commentDialog.html",className:"ngdialog-theme-plain",controller:["$scope","$http","$location","YiServer",function(t,o,r,s){t.commentShow="说点什么",t.commentId=null,void 0!=e&&void 0!=e.content.user&&(t.commentShow="回复："+e.content.user,t.commentId=e.id),t.commentValue="",t.commentSend=function(){""!=t.commentValue?s.toComment("articles",n.param,t.commentValue,t.commentId).then(function(e){i.call("toToastCallBack",{toast:"评论成功"}),n.getComment(),a.close()}):i.call("toToastCallBack",{toast:"评论不能为空"})}}],showClose:!1})},this.loginDialog=function(){a.open({id:"loginDialog",template:"/html/loginDialog.html",className:"ngdialog-theme-plain",showClose:!1,controller:["$scope","$http","$location","$window","YiServer",function(e,t,o,r,s){e.user={},e.user.name="",e.user.passWord="",e.toLogin=function(){return e.user.name.length<1?void i.call("toToastCallBack",{toast:"用户名不能为空"}):e.user.passWord.length<1?void i.call("toToastCallBack",{toast:"密码不能为空"}):void s.toLogin(n.param,e.user.name,e.user.passWord).then(function(e){return"error.openapi.user.notfound"==e?(i.call("toToastCallBack",{toast:"用户名或密码错误"}),""):(a.close(),void i.call("toToastCallBack",{toast:"成功登录"}))})}}]})},this.signDialog=function(){a.open({id:"signDialog",template:"/html/signDialog.html",className:"ngdialog-theme-plain",showClose:!1,controller:["$scope","$http","$location","$window","YiServer",function(e,t,o,r,s){e.user={},e.user.name="",e.user.passWord="",e.user.nickName="",e.toSign=function(){return e.user.name.length<1?void i.call("toToastCallBack",{toast:"用户名不能为空"}):e.user.passWord.length<6?void i.call("toToastCallBack",{toast:"密码不符合要求"}):e.user.nickName.length<1||e.user.nickName.length>10?void i.call("toToastCallBack",{toast:"昵称长度大于0小于10位"}):1!=e.user.green?void i.call("toToastCallBack",{toast:"请阅读《注册协议》和《版权声明》"}):void s.toSign(n.param,e.user.name,e.user.passWord,e.user.nickName).then(function(e){return"You have been the group member"==e?(i.call("toToastCallBack",{toast:"已被注册"}),""):(a.close(),void i.call("toToastCallBack",{toast:"完成注册，已成功登录"}))})}}]})}}]),angular.module("YiModule").service("CompareTime",function(){this.getTime=function(e){var t=e.substring(0,4),o=e.substring(4,6),n=e.substring(6,8),i=e.substring(8,10),a=e.substring(10,12);e.substring(12,14);return t+"."+o+"."+n+" "+i+":"+a}}),angular.module("articles",["ngSanitize","env","apps","ngDialog","YiModule"],["$locationProvider","$sceDelegateProvider",function(e,t){e.html5Mode(!0),t.resourceUrlWhitelist(["self","**"])}]),angular.module("articles").controller("articles.DetailCtrl",["$scope","$rootScope","$window","$http","$timeout","$env","appDownload","SysConfig","findDetails","CompareTime","ngDialog","YiServer",function(e,t,o,n,i,a,r,s,l,c,u,d){function p(){var t=o.document.documentElement.clientWidth,n=3.5;e.headerImageCornerStyle={"border-bottom":n+"em solid #fff","border-left":t+"px solid transparent",width:0,height:0,"margin-top":.05-n+"em",position:"absolute"}}o.onscroll=d.scrollUpOrDown,e.toTop=d.toTop,e.scrollTo=function(o){document.getElementById(o)&&(e.toTop(document.getElementById(o).offsetTop),t.scrollUpOrDown=!0)},e.compareTime=c,e.$env=a,e.platform=a.platform(),"true"==t.param.inClient&&(e.$env.inClient=!0,a.inClient=!0,a.setInClient(!0)),t.getArticleDetail=function(){t.param.base&&t.param.id&&d.getDetail("articles",t.param).then(function(o){return t.getComment(),e.item=o,d.getUserDetail(t.param,e.item.user.id).then(function(t){void 0==e.item.user.fans&&(e.item.user.fans={count:0,item:[]}),e.item.user.fans=t.data.fans}),e.__=e.item[e.platform],void 0==e.__.apps?null:(a.isAndroid||a.isIOS?e.showApps=e.__.apps[e.platform]:e.showApps=e.__.apps.android?e.__.apps.android.concat(e.__.apps.ios?e.__.apps.ios:[]):e.__.apps.ios?e.__.apps.ios:[],void(void 0!==e.item.collections&&(e.item.isCollected=d.isInclude(e.item.collections.users,t.param.user_id))))})};var m=0,f=5;t.getComment=function(){d.getComments("articles",t.param,m,f).then(function(t){if(e.commentfs={},0!=t.data.results.length){for(var o=0;o<t.data.results.length;o++){t.data.results[o].quote=[];var n=t.data.results[o].content;e.show=function(n){return void 0==n.quote?!0:(t.data.results[o].quote.push(n.quote),void e.show(n.quote))},e.show(n),e.commentfs=t.data.results,e.commentfs.showMore=!1,t.data.count<t.data.total&&(e.commentfs.showMore=!0)}for(var o=0;o<e.commentfs.length;o++){e.commentfs[o].createdOn=e.compareTime.getTime(e.commentfs[o].createdOn);for(var i=0;i<e.commentfs[o].quote.length;i++)e.commentfs[o].quote[i].orderId=e.commentfs[o].quote.length-i,e.commentfs[o].quote[i].child=[];if(e.commentfs[o].quote.length>0){var a=[];e.commentfs[o].quote=e.toNeedArray(a,e.commentfs[o].quote)}}}})},e.showMoreComment=function(){f=5+f,t.getComment()},e.openYingYong=function(e){d.appDownloadDialog(e)},e.openKuPin=function(e){d.smartDialog(e)},e.openShare=function(e){return a.isAndroid&&a.inClient?void a.call("toShare"):(d.shareStatistics(t.param,"articles",3),void d.shareDialog(e))},e.showCommentDialog=function(o){return 1==t.isVisitor&&a.inClient!==!0?void t.login():(e.$env.isAndroid&&e.$env.inClient,void d.commentDialog(o))},e.subscribeAuthor=function(){return 1==t.isVisitor&&a.inClient!==!0?void t.login():void(e.item.user.hasSub?d.unFocusAuthor(t.param,e.item.user.id).then(function(t){e.item.user.hasSub=!e.item.user.hasSub,e.item.user.fans.count=e.item.user.fans.count-1}):d.focusAuthor(t.param,e.item.user.id).then(function(t){e.item.user.hasSub=!e.item.user.hasSub,void 0==e.item.user.fans&&(e.item.user.fans={count:0}),e.item.user.fans.count=e.item.user.fans.count+1}))},e.collecteAticle=function(){return 1==t.isVisitor&&a.inClient!==!0?void t.login():void(void 0==e.item.isCollected||0==e.item.isCollected?d.collecteType("articles",t.param).then(function(t){e.item.isCollected=!0,a.call("toToastCallBack",{toast:"收藏成功"})}):d.unCollecteType("articles",t.param).then(function(t){e.item.isCollected=!1,a.call("toToastCallBack",{toast:"取消收藏"})}))},e.collectionStyle=function(){return void 0==e.item&&(e.item={isCollected:!1}),e.item.isCollected?{color:"#0099e5"}:void 0},e.attitude=function(o,n){if(1==t.isVisitor&&a.inClient!==!0)return void t.login();var i=(a.isIOS?"ios":"android",e.item.attitudes.scored);i?a.call("toToastCallBack",{toast:"您已经点过态度了"}):d.clickAttitude("articles",t.param,n,o.id).then(function(t){e.item.attitudes.scored||(e.item.attitudes.scored=!0,o.users.count+=1,o.hasClick=!0)})},e.attitudesColorStyle=function(e){return e.hasClick?{color:"#e5e5e5"}:{color:"#0099e5"}},e.attitudeToZan=function(e){return 1==t.isVisitor&&a.inClient!==!0?void t.login():void d.clickCommentZan("articles",t.param,e.id).then(function(t){200==t.code&&(void 0==e.attitudes&&(e.attitudes={},e.attitudes.count={},e.attitudes.count.like=0),e.attitudes.count.like=e.attitudes.count.like+1)},function(e){429==e.code&&a.call("toToastCallBack",{toast:"您已经点过赞了"})})},e.subscribeArticle=function(e){return 1==t.isVisitor&&a.inClient!==!0?void t.login():void(e.hasSub?d.UnFocusTag(t.param,e.id).then(function(){e.hasSub=!e.hasSub}):d.focusTag(t.param,e.id).then(function(){e.hasSub=!e.hasSub}))},e.toBack=function(){e.$env.inClient?a.call("toBackCallback",{nums:1}):history.go(-1)},i(p,100),e.attitudesBarStyle=function(t){var o=100*(t.users.count/e.attitudesCount);return{height:o+"%"}},e.louStyle=function(e){return e.orderId>5?{"border-left":"0px solid rgba(0, 51, 77, 0.1)","border-right":"0px solid rgba(0, 51, 77, 0.1)","padding-left":"0px ","padding-right":"0px"}:void 0};var h=0;e.toNeedArray=function(t,o){return t.push(o[h]),h<o.length&&(h+=1,e.toNeedArray(t[0].child,o)),h=0,t},e.findDetails=function(e,o){l(e,o,t.param)},e.$watch(function(){if(e.item&&e.item.attitudes){var t=0;for(var o in e.item.attitudes.items)t+=e.item.attitudes.items[o].users.count;e.attitudesCount=t}}),t.messageDialog=function(e){var t=u.open({template:'<div align="center" >'+e+"</div>",plain:!0,closeByDocument:!0,closeByEscape:!0,showClose:!1});setTimeout(function(){t.close()},1200)},e.toUserHome=function(){a.readOnlyInHere||a.call("toUserHome",{id:e.item.user.id})},void 0==t.param._token?void 0!=o.localStorage.getItem("login_user_token")?(t.param._token=o.localStorage.getItem("login_user_token"),t.param.user_id=o.localStorage.getItem("login_user_id"),t.getArticleDetail(),d.getUserDetail(t.param,t.param.user_id).then(function(e){1==e.data.type&&1!=a.inClient&&(t.isVisitor=!0),t.loginUserNickName=e.data.nickName})):d.toSignFree(t.param).then(function(e){t.getArticleDetail(),t.isVisitor=!0}):t.getArticleDetail(),t.login=function(){u.close(),d.loginDialog()},t.sign=function(){u.close(),d.signDialog()}}]);